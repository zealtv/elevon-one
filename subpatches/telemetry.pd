#N canvas 720 23 720 855 10;
#X declare -lib cyclone;
#X obj 100 100 cnv 15 260 540 empty empty empty 20 12 0 14 #f9f9f9
#404040 0;
#X obj 80 1190 cnv 15 260 110 empty \$0cvs1 empty 20 12 0 14 #ffb299
#000000 0;
#X obj 130 870 cnv 15 260 140 empty \$0cvs5 empty 20 12 0 14 #e5ff99
#000000 0;
#X obj 700 1210 cnv 15 260 140 empty \$0cvs8 empty 20 12 0 14 #99ff99
#000000 0;
#X obj 80 1050 cnv 15 260 140 empty \$0cvs0 empty 20 12 0 14 #ff9999
#000000 0;
#X obj 80 1300 cnv 15 260 130 empty \$0cvs2 empty 20 12 0 14 #ffcc99
#000000 0;
#X obj 80 1560 cnv 15 260 130 empty \$0cvs4 empty 20 12 0 14 #ffff99
#000000 0;
#X obj 80 1430 cnv 15 260 130 empty \$0cvs3 empty 20 12 0 14 #ffe599
#000000 0;
#X obj 650 1210 cnv 15 260 140 empty \$0cvs6 empty 20 12 0 14 #ccff99
#000000 0;
#X obj 710 715 send, f 10;
#X obj 710 669 cyclone/zl rev;
#X obj 710 692 unpack f s;
#X floatatom 280 250 10 0 0 0 t t -, f 10;
#X floatatom 280 290 10 0 0 0 sync sync -, f 10;
#X floatatom 140 250 10 0 0 0 lat lat -, f 10;
#X floatatom 140 270 10 0 0 0 lon lon -, f 10;
#X floatatom 140 290 10 0 0 0 alt alt -, f 10;
#X floatatom 140 310 10 0 0 0 h h -, f 10;
#X obj 940 176 netreceive -u -b;
#X msg 940 153 listen 4813;
#X obj 880 230 oscparse;
#X obj 880 276 route telemetry;
#X obj 880 253 route list;
#X obj 940 130 loadbang;
#X obj 710 600 zl nth;
#X obj 710 443 unpack, f 8;
#X obj 710 466 + 1;
#X obj 590 470 loadbang;
#X obj 710 623 pack s f;
#X obj 710 646 route list;
#X obj 710 489 t b f, f 6;
#X obj 710 420 listfunnel;
#X obj 570 420 declare -lib cyclone;
#X floatatom 530 1020 5 0 0 0 - - -, f 5;
#X obj 650 1170 s, f 22;
#X obj 780 1130 sprintf symbol \$0cvs%i;
#X floatatom 140 340 10 0 0 0 px px -, f 10;
#X floatatom 140 360 10 0 0 0 py py -, f 10;
#X floatatom 140 380 10 0 0 0 pz pz -, f 10;
#X floatatom 140 540 10 0 0 0 vx vx -, f 10;
#X floatatom 140 560 10 0 0 0 vy vy -, f 10;
#X floatatom 140 580 10 0 0 0 vz vz -, f 10;
#X floatatom 270 540 10 0 0 0 ax ax -, f 10;
#X floatatom 270 560 10 0 0 0 ay ay -, f 10;
#X floatatom 270 580 10 0 0 0 az az -, f 10;
#X floatatom 270 450 10 0 0 0 rvx rvx -, f 10;
#X floatatom 270 430 10 0 0 0 rvy rvy -, f 10;
#X floatatom 270 470 10 0 0 0 rvz rvz -, f 10;
#X obj 650 1131 sub.lvn.rainbowmaker;
#X msg 590 500 t sync px py pz lat lon alt qx qy qz qw h vx vy vz ax
ay az rvx rvy rvz, f 17;
#X floatatom 140 450 10 0 0 0 roll roll -, f 10;
#X floatatom 140 470 10 0 0 0 yaw yaw -, f 10;
#X floatatom 140 490 10 0 0 0 inv inv -, f 10;
#X floatatom 140 430 10 0 0 0 pitch pitch -, f 10;
#X msg 1440 500 \$14 \$15;
#X floatatom 140 610 10 0 0 0 gs gs -, f 10;
#X obj 1440 650 s gs;
#X text 1430 430 calculate groundspeed;
#X obj 1440 540 unpack f f;
#X obj 1438 567 *;
#X obj 1490 565 *;
#X obj 1440 600 +;
#X obj 1440 625 sqrt;
#N canvas 794 23 886 1005 quat2euler-telemosc 0;
#X obj 400 300 expr -1 * atan2( 2 * ($f1 * $f4 + $f2 * $f3) \, 1 -
2 * ($f3 * $f3 + $f4 * $f4)), f 82;
#X obj 1110 380 abs;
#X obj 1140 410 / 2;
#X obj 420 580 *;
#X obj 400 620 +;
#X obj 400 460 + 3.14159;
#X obj 430 740 * 2;
#X obj 400 780 fmod, f 5;
#X obj 800 200 s \$0-pi;
#X obj 800 170 pi;
#X obj 800 130 bng 29 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 800 100 loadbang;
#X obj 440 530 r \$0-pi;
#X obj 430 700 r \$0-pi;
#X obj 420 860 * 2;
#X obj 420 820 r \$0-pi;
#X obj 400 900 /;
#X obj 400 930 * 360;
#X text 510 760 this takes into account inversion to correct yaw \,
resulting in heading if normalised to magnetic north - only required
if not available as precomputed data point, f 25;
#X text 400 400 calculate heading from yaw, f 27;
#X text 500 330 yaw is offset by 180 degrees orientation is inverted
;
#X obj 100 300 expr asin( 2 * ($f1 * $f3 - $f4 * $f2) );
#X obj 1000 300 expr atan2( 2 * ($f1 * $f2 + $f3 * $f4) \, 1- 2 * ($f2
* $f2 + $f3 * $f3)), f 73;
#X obj 400 420 r \$0-yaw-raw;
#X obj 400 330 s \$0-yaw-raw;
#X obj 1110 490 s inv;
#X obj 1140 380 r \$0-pi;
#X obj 120 360 / 2;
#X obj 120 330 r \$0-pi;
#X obj 100 390 +;
#X obj 100 450 /;
#X obj 120 420 r \$0-pi;
#X obj 1010 400 r \$0-pi;
#X obj 1000 430 +;
#X obj 1030 430 r \$0-pi;
#X obj 1000 500 /;
#X obj 1030 460 * 2;
#X obj 1000 530 * 360;
#X obj 100 540 - 90;
#X obj 100 100 inlet;
#X obj 1000 570 outlet;
#X obj 100 590 outlet;
#X obj 400 990 outlet;
#X text 1060 270 currently yaw;
#X obj 100 490 * 180;
#X text 100 700 Φ = atan2(2(q0q1+q2q3) \, 1-2(q1q2+q2q2)) \; θ
= asin(2(q0q2-q3q1)) \; ψ = atan2(2(q0q3+q1q2)
\, 1-2(q2q2+q3q2)) \; , f 44;
#X obj 1110 450 <;
#X obj 470 570 r inv;
#X obj 200 480 >= 0;
#X obj 470 640 *;
#X obj 490 590 r \$0-pi;
#X obj 400 670 +;
#X obj 400 960 - 180;
#X connect 0 0 24 0;
#X connect 1 0 46 0;
#X connect 2 0 46 1;
#X connect 3 0 4 1;
#X connect 4 0 51 0;
#X connect 5 0 4 0;
#X connect 6 0 7 1;
#X connect 7 0 16 0;
#X connect 9 0 8 0;
#X connect 10 0 9 0;
#X connect 11 0 10 0;
#X connect 12 0 3 1;
#X connect 13 0 6 0;
#X connect 14 0 16 1;
#X connect 15 0 14 0;
#X connect 16 0 17 0;
#X connect 17 0 52 0;
#X connect 21 0 29 0;
#X connect 22 0 33 0;
#X connect 22 0 1 0;
#X connect 23 0 5 0;
#X connect 26 0 2 0;
#X connect 27 0 29 1;
#X connect 28 0 27 0;
#X connect 29 0 30 0;
#X connect 30 0 44 0;
#X connect 30 0 48 0;
#X connect 31 0 30 1;
#X connect 32 0 33 1;
#X connect 33 0 35 0;
#X connect 34 0 36 0;
#X connect 35 0 37 0;
#X connect 36 0 35 1;
#X connect 37 0 40 0;
#X connect 38 0 41 0;
#X connect 39 0 0 0;
#X connect 39 0 22 0;
#X connect 39 0 21 0;
#X connect 44 0 38 0;
#X connect 46 0 25 0;
#X connect 47 0 49 0;
#X connect 48 0 3 0;
#X connect 49 0 51 1;
#X connect 50 0 49 1;
#X connect 51 0 7 0;
#X connect 52 0 42 0;
#X restore 890 505 pd quat2euler-telemosc;
#X obj 890 545 s pitch;
#X obj 950 545 s roll;
#X obj 1020 545 s yaw;
#N canvas 0 23 840 1005 quat2euler-gyrosc 0;
#X obj 1080 190 expr -1 * atan2( 2 * ($f1 * $f4 + $f2 * $f3) \, 1 -
2 * ($f3 * $f3 + $f4 * $f4)), f 82;
#X obj 230 230 abs;
#X obj 230 300 >;
#X obj 260 260 / 2;
#X obj 1750 310 *;
#X obj 1730 350 +;
#X obj 1730 190 + 3.14159;
#X obj 1760 390 * 2;
#X obj 1730 430 fmod, f 5;
#X obj 1750 230 r \$0-inverted;
#X obj 1960 230 s \$0-pi;
#X obj 1960 200 pi;
#X obj 1960 160 bng 29 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 1960 130 loadbang;
#X obj 1770 260 r \$0-pi;
#X obj 1760 350 r \$0-pi;
#X obj 1750 510 * 2;
#X obj 1750 470 r \$0-pi;
#X obj 1730 550 /;
#X obj 1730 580 * 360;
#X text 1840 410 this takes into account inversion to correct yaw \,
resulting in heading if normalised to magnetic north - only required
if not available as precomputed data point, f 25;
#X text 1730 130 calculate heading from yaw, f 27;
#X text 1180 220 yaw is offset by 180 degrees orientation is inverted
;
#X obj 660 200 expr asin( 2 * ($f1 * $f3 - $f4 * $f2) );
#X obj 140 200 expr atan2( 2 * ($f1 * $f2 + $f3 * $f4) \, 1- 2 * ($f2
* $f2 + $f3 * $f3)), f 73;
#X obj 1730 150 r \$0-yaw-raw;
#X obj 1080 220 s \$0-yaw-raw;
#X obj 230 340 s inv;
#X obj 260 230 r \$0-pi;
#X text 1080 250 Φ = atan2(2(q0q1+q2q3) \, 1-2(q12+q22)) \; θ
= asin(2(q0q2-q3q1)) \; ψ = atan2(2(q0q3+q1q2)
\, 1-2(q22+q32)) \; , f 79;
#X text 140 110 quaternion to euler conversion;
#X obj 680 260 / 2;
#X obj 680 230 r \$0-pi;
#X obj 660 290 +;
#X obj 660 350 /;
#X obj 680 320 r \$0-pi;
#X obj 150 230 r \$0-pi;
#X obj 140 260 +;
#X obj 170 260 r \$0-pi;
#X obj 140 330 /;
#X obj 170 290 * 2;
#X obj 140 360 * 360;
#X obj 390 80 inlet;
#X obj 140 390 outlet;
#X obj 660 450 outlet;
#X obj 1730 605 outlet;
#X obj 660 390 * 180;
#X obj 660 420 - 90;
#X connect 0 0 26 0;
#X connect 1 0 2 0;
#X connect 2 0 27 0;
#X connect 3 0 2 1;
#X connect 4 0 5 1;
#X connect 5 0 8 0;
#X connect 6 0 5 0;
#X connect 7 0 8 1;
#X connect 8 0 18 0;
#X connect 9 0 4 0;
#X connect 11 0 10 0;
#X connect 12 0 11 0;
#X connect 13 0 12 0;
#X connect 14 0 4 1;
#X connect 15 0 7 0;
#X connect 16 0 18 1;
#X connect 17 0 16 0;
#X connect 18 0 19 0;
#X connect 19 0 45 0;
#X connect 23 0 33 0;
#X connect 24 0 1 0;
#X connect 24 0 39 0;
#X connect 25 0 6 0;
#X connect 28 0 3 0;
#X connect 31 0 33 1;
#X connect 32 0 31 0;
#X connect 33 0 34 0;
#X connect 34 0 46 0;
#X connect 35 0 34 1;
#X connect 36 0 37 1;
#X connect 37 0 39 0;
#X connect 38 0 40 0;
#X connect 39 0 41 0;
#X connect 40 0 39 1;
#X connect 41 0 43 0;
#X connect 42 0 24 0;
#X connect 42 0 23 0;
#X connect 42 0 0 0;
#X connect 46 0 47 0;
#X connect 47 0 44 0;
#X restore 1178 502 pd quat2euler-gyrosc;
#X obj 1440 470 r \$0-telem-raw;
#X obj 1170 280 gyrosc2elevon;
#X text 1170 800 0 is level \; -90 is roll left \; 90 is roll right
\; returns to 0 when inverted;
#X text 890 770 GYROSC;
#X text 890 800 0 is level \; 90 is up \; 180/-180 is inverted
level \; -90 is down \;  \; 90 to 180 \, and -180 to -90 is
inverted, f 26;
#X text 890 650 0 is level \; -90 is roll left \; 90 is roll right
\; returns to 0 when inverted;
#X text 1180 630 0 is level \; 90 is up \; 180/-180 is inverted
level \; -90 is down \;  \; 90 to 180 \, and -180 to -90 is
inverted, f 26;
#X text 890 620 TELEMOSC;
#X obj 640 115 r /telemetry;
#X obj 120 110 data-playback;
#X text 890 590 ----PITCH----;
#X text 1180 590 ----ROLL----;
#X obj 320 140 vradio 20 0 1 3 \$0-source \$0-source empty 0 -8 0 10
#fcfcfc #000000 #000000 2;
#X text 270 180 gyrOSC;
#X text 260 160 telemOSC;
#X obj 590 155 gate, f 11;
#X obj 590 80 r \$0-source;
#X obj 880 200 gate, f 11;
#X obj 880 90 r \$0-source;
#X obj 1170 230 gate, f 11;
#X obj 1170 120 r \$0-source;
#X text 590 40 Log;
#X text 1170 50 gyrOSC;
#X text 940 50 telemOSC;
#X obj 590 120 == 0;
#X obj 880 120 == 1;
#X obj 1170 150 == 2;
#X obj 1230 200 netreceive -u -b;
#X msg 1230 175 listen 9999;
#X obj 1230 150 loadbang;
#X obj 1178 542 s pitch;
#X obj 1238 542 s roll;
#X obj 1298 542 s yaw;
#X text 300 110 SOURCE;
#X text 400 100 PORTS;
#X obj 590 200 s \$0-telem-raw;
#X text 1710 1370 comment;
#X text 1040 430 Quaternion to Euler;
#X obj 1170 340 s \$0-gyrosc-quat;
#X obj 1180 470 r \$0-gyrosc-quat;
#X obj 980 340 s \$0-telelmosc-quat;
#X msg 980 310 \$9 \$10 \$11 \$12;
#X obj 890 470 r \$0-telelmosc-quat;
#X obj 880 310 s \$0-telem-raw;
#X obj 710 390 r \$0-telem-raw;
#X floatatom 280 270 10 0 0 0 v-time v-time -, f 10;
#X obj 530 1100 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X text 280 230 TIME;
#X text 140 230 POSITION;
#X text 140 520 VELOCITY;
#X text 270 520 ACCELERATION;
#X text 270 410 ROLL-RATE;
#X text 140 410 ORIENTATION;
#X msg 530 1130 vis_size 260 140;
#X obj 530 950 f, f 13;
#X obj 590 980 + 1;
#X msg 620 910 0;
#X obj 530 920 until;
#X obj 530 880 t i b i, f 30;
#X text 400 120 telemOSC 4813;
#X text 400 140 gyrOSC 9999;
#X text 400 160 v-time 1984;
#X obj 530 1060 t b f f, f 42;
#X obj 368 1136 print;
#X obj 650 1100 / 16, f 10;
#X msg 530 850 24;
#X text 290 140 Log;
#X text 200 340 ▶ north;
#X text 200 360 ▶ east;
#X text 200 380 ▶ up;
#X text 200 580 ▶ up;
#X text 510 740 ▶ forward;
#X text 510 760 ▶ right;
#X text 510 780 ▶ up;
#X text 200 540 ▶ fwd;
#X text 200 560 ▶ right;
#X obj 850 145 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X floatatom 840 170 5 0 0 0 - - -, f 5;
#X floatatom 1150 200 5 0 0 0 - - -, f 5;
#X connect 10 0 11 0;
#X connect 11 0 9 0;
#X connect 11 1 9 1;
#X connect 18 0 85 1;
#X connect 19 0 18 0;
#X connect 20 0 22 0;
#X connect 21 0 109 0;
#X connect 21 0 111 0;
#X connect 22 0 21 0;
#X connect 23 0 19 0;
#X connect 24 0 28 0;
#X connect 25 0 26 0;
#X connect 25 1 28 1;
#X connect 26 0 30 0;
#X connect 27 0 49 0;
#X connect 28 0 29 0;
#X connect 29 0 10 0;
#X connect 30 0 24 0;
#X connect 30 1 24 1;
#X connect 31 0 25 0;
#X connect 33 0 130 0;
#X connect 35 0 34 1;
#X connect 48 0 34 0;
#X connect 49 0 24 0;
#X connect 54 0 58 0;
#X connect 58 0 59 1;
#X connect 58 0 59 0;
#X connect 58 1 60 1;
#X connect 58 1 60 0;
#X connect 59 0 61 0;
#X connect 60 0 61 1;
#X connect 61 0 62 0;
#X connect 62 0 56 0;
#X connect 63 0 64 0;
#X connect 63 1 65 0;
#X connect 63 2 66 0;
#X connect 67 0 98 0;
#X connect 67 1 99 0;
#X connect 67 2 100 0;
#X connect 68 0 54 0;
#X connect 69 0 106 0;
#X connect 76 0 83 1;
#X connect 83 0 103 0;
#X connect 84 0 92 0;
#X connect 85 0 20 0;
#X connect 86 0 93 0;
#X connect 87 0 69 0;
#X connect 88 0 94 0;
#X connect 92 0 83 0;
#X connect 93 0 85 0;
#X connect 93 0 144 0;
#X connect 93 0 145 0;
#X connect 94 0 87 0;
#X connect 94 0 146 0;
#X connect 95 0 87 1;
#X connect 96 0 95 0;
#X connect 97 0 96 0;
#X connect 107 0 67 0;
#X connect 109 0 108 0;
#X connect 110 0 63 0;
#X connect 112 0 31 0;
#X connect 114 0 121 0;
#X connect 121 0 34 0;
#X connect 122 0 123 0;
#X connect 122 0 33 0;
#X connect 123 0 122 1;
#X connect 124 0 122 1;
#X connect 125 0 122 0;
#X connect 126 0 125 0;
#X connect 126 1 124 0;
#X connect 126 2 132 1;
#X connect 130 0 114 0;
#X connect 130 1 132 0;
#X connect 130 2 35 0;
#X connect 132 0 48 0;
#X connect 133 0 126 0;
#X coords 0 -1 1 1 260 540 2 100 100;
