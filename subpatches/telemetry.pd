#N canvas 5 23 962 1005 10;
#X declare -lib cyclone;
#X obj 10 10 cnv 15 120 410 empty empty empty 20 12 0 14 #e0e0e0 #404040
0;
#X obj 20 162 cnv 15 30 65 empty \$0cvs4 empty 20 12 0 14 #99ffff #000000
0;
#X obj 20 116 cnv 15 30 48 empty \$0cvs3 empty 20 12 0 14 #99ffb2 #000000
0;
#X obj 20 20 cnv 15 30 32 empty \$0cvs1 empty 20 12 0 14 #ffe599 #000000
0;
#X obj 21 276 cnv 15 30 64 empty \$0cvs6 empty 20 12 0 14 #cc99ff #000000
0;
#X obj 20 52 cnv 15 30 64 empty \$0cvs2 empty 20 12 0 14 #ccff99 #000000
0;
#X obj 300 536 send, f 10;
#X obj 300 490 cyclone/zl rev;
#X obj 300 513 unpack f s;
#X floatatom 52 20 10 0 0 0 t t -, f 10;
#X floatatom 52 36 10 0 0 0 sync sync -, f 10;
#X floatatom 52 52 10 0 0 0 lat lat -, f 10;
#X floatatom 52 68 10 0 0 0 lon lon -, f 10;
#X floatatom 52 84 10 0 0 0 alt alt -, f 10;
#X floatatom 52 100 10 0 0 0 h h -, f 10;
#X obj 350 116 netreceive -u -b;
#X msg 350 93 listen 4813;
#X obj 300 190 oscparse;
#X obj 300 236 route telemetry;
#X obj 300 213 route list;
#X obj 350 70 loadbang;
#X obj 300 421 zl nth;
#X obj 300 352 unpack, f 8;
#X obj 300 375 + 1;
#X obj 186 283 loadbang;
#X obj 300 444 pack s f;
#X obj 300 467 route list;
#X obj 300 398 t b f, f 6;
#X obj 300 329 listfunnel;
#X obj 500 20 declare -lib cyclone;
#X floatatom 40 590 5 0 0 0 - - -, f 5;
#X obj 40 650 / 8;
#X obj 40 720 s, f 22;
#X obj 40 620 t f f, f 21;
#X obj 170 660 sprintf symbol \$0cvs%i;
#X floatatom 52 116 10 0 0 0 px px -, f 10;
#X floatatom 52 132 10 0 0 0 py py -, f 10;
#X floatatom 52 148 10 0 0 0 pz pz -, f 10;
#X floatatom 52 164 10 0 0 0 vx vx -, f 10;
#X floatatom 52 180 10 0 0 0 vy vy -, f 10;
#X floatatom 52 196 10 0 0 0 vz vz -, f 10;
#X obj 21 228 cnv 15 30 48 empty \$0cvs5 empty 20 12 0 14 #99b2ff #000000
0;
#X floatatom 53 228 10 0 0 0 ax ax -, f 10;
#X floatatom 53 244 10 0 0 0 ay ay -, f 10;
#X floatatom 53 260 10 0 0 0 az az -, f 10;
#X obj 21 339 cnv 15 30 48 empty \$0cvs7 empty 20 12 0 14 #ff99e5 #000000
0;
#X floatatom 53 339 10 0 0 0 rvx rvx -, f 10;
#X floatatom 53 355 10 0 0 0 rvy rvy -, f 10;
#X floatatom 53 371 10 0 0 0 rvz rvz -, f 10;
#X obj 40 681 sub.lvn.rainbowmaker;
#X msg 186 306 t sync px py pz lat lon alt qx qy qz qw h vx vy vz ax
ay az rvx rvy rvz, f 17;
#X floatatom 53 292 10 0 0 0 roll roll -, f 10;
#X floatatom 53 308 10 0 0 0 yaw yaw -, f 10;
#X floatatom 53 324 10 0 0 0 inv inv -, f 10;
#X floatatom 53 277 10 0 0 0 pitch pitch -, f 10;
#X msg 600 370 \$9 \$10 \$11 \$12;
#X msg 360 680 \$14 \$15;
#X floatatom 52 212 10 0 0 0 gs gs -, f 10;
#X obj 360 830 s gs;
#X text 360 630 calculate groundspeed;
#X obj 360 720 unpack f f;
#X obj 358 747 *;
#X obj 410 745 *;
#X obj 360 780 +;
#X obj 360 805 sqrt;
#N canvas 794 23 886 1005 quat2euler-telemosc 0;
#X obj 400 300 expr -1 * atan2( 2 * ($f1 * $f4 + $f2 * $f3) \, 1 -
2 * ($f3 * $f3 + $f4 * $f4)), f 82;
#X obj 1110 380 abs;
#X obj 1140 410 / 2;
#X obj 420 580 *;
#X obj 400 620 +;
#X obj 400 460 + 3.14159;
#X obj 430 740 * 2;
#X obj 400 780 fmod, f 5;
#X obj 800 200 s \$0-pi;
#X obj 800 170 pi;
#X obj 800 130 bng 29 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 800 100 loadbang;
#X obj 440 530 r \$0-pi;
#X obj 430 700 r \$0-pi;
#X obj 420 860 * 2;
#X obj 420 820 r \$0-pi;
#X obj 400 900 /;
#X obj 400 930 * 360;
#X text 510 760 this takes into account inversion to correct yaw \,
resulting in heading if normalised to magnetic north - only required
if not available as precomputed data point, f 25;
#X text 400 400 calculate heading from yaw, f 27;
#X text 500 330 yaw is offset by 180 degrees orientation is inverted
;
#X obj 100 300 expr asin( 2 * ($f1 * $f3 - $f4 * $f2) );
#X obj 1000 300 expr atan2( 2 * ($f1 * $f2 + $f3 * $f4) \, 1- 2 * ($f2
* $f2 + $f3 * $f3)), f 73;
#X obj 400 420 r \$0-yaw-raw;
#X obj 400 330 s \$0-yaw-raw;
#X obj 1110 490 s inv;
#X obj 1140 380 r \$0-pi;
#X obj 120 360 / 2;
#X obj 120 330 r \$0-pi;
#X obj 100 390 +;
#X obj 100 450 /;
#X obj 120 420 r \$0-pi;
#X obj 1010 400 r \$0-pi;
#X obj 1000 430 +;
#X obj 1030 430 r \$0-pi;
#X obj 1000 500 /;
#X obj 1030 460 * 2;
#X obj 1000 530 * 360;
#X obj 100 540 - 90;
#X obj 100 100 inlet;
#X obj 1000 570 outlet;
#X obj 100 590 outlet;
#X obj 400 990 outlet;
#X text 1060 270 currently yaw;
#X obj 100 490 * 180;
#X text 100 700 Φ = atan2(2(q0q1+q2q3) \, 1-2(q1q2+q2q2)) \; θ
= asin(2(q0q2-q3q1)) \; ψ = atan2(2(q0q3+q1q2)
\, 1-2(q2q2+q3q2)) \; , f 44;
#X obj 1110 450 <;
#X obj 470 570 r inv;
#X obj 200 480 >= 0;
#X obj 470 640 *;
#X obj 490 590 r \$0-pi;
#X obj 400 670 +;
#X obj 400 960 - 180;
#X connect 0 0 24 0;
#X connect 1 0 46 0;
#X connect 2 0 46 1;
#X connect 3 0 4 1;
#X connect 4 0 51 0;
#X connect 5 0 4 0;
#X connect 6 0 7 1;
#X connect 7 0 16 0;
#X connect 9 0 8 0;
#X connect 10 0 9 0;
#X connect 11 0 10 0;
#X connect 12 0 3 1;
#X connect 13 0 6 0;
#X connect 14 0 16 1;
#X connect 15 0 14 0;
#X connect 16 0 17 0;
#X connect 17 0 52 0;
#X connect 21 0 29 0;
#X connect 22 0 33 0;
#X connect 22 0 1 0;
#X connect 23 0 5 0;
#X connect 26 0 2 0;
#X connect 27 0 29 1;
#X connect 28 0 27 0;
#X connect 29 0 30 0;
#X connect 30 0 44 0;
#X connect 30 0 48 0;
#X connect 31 0 30 1;
#X connect 32 0 33 1;
#X connect 33 0 35 0;
#X connect 34 0 36 0;
#X connect 35 0 37 0;
#X connect 36 0 35 1;
#X connect 37 0 40 0;
#X connect 38 0 41 0;
#X connect 39 0 0 0;
#X connect 39 0 22 0;
#X connect 39 0 21 0;
#X connect 44 0 38 0;
#X connect 46 0 25 0;
#X connect 47 0 49 0;
#X connect 48 0 3 0;
#X connect 49 0 51 1;
#X connect 50 0 49 1;
#X connect 51 0 7 0;
#X connect 52 0 42 0;
#X restore 600 400 pd quat2euler-telemosc;
#X obj 600 470 s pitch;
#X obj 670 470 s roll;
#X obj 730 470 s yaw;
#N canvas 0 23 840 1005 quat2euler-gyrosc 0;
#X obj 1080 190 expr -1 * atan2( 2 * ($f1 * $f4 + $f2 * $f3) \, 1 -
2 * ($f3 * $f3 + $f4 * $f4)), f 82;
#X obj 230 230 abs;
#X obj 230 300 >;
#X obj 260 260 / 2;
#X obj 1750 310 *;
#X obj 1730 350 +;
#X obj 1730 190 + 3.14159;
#X obj 1760 390 * 2;
#X obj 1730 430 fmod, f 5;
#X obj 1750 230 r \$0-inverted;
#X obj 1960 230 s \$0-pi;
#X obj 1960 200 pi;
#X obj 1960 160 bng 29 250 50 0 empty empty empty 17 7 0 10 #fcfcfc
#000000 #000000;
#X obj 1960 130 loadbang;
#X obj 1770 260 r \$0-pi;
#X obj 1760 350 r \$0-pi;
#X obj 1750 510 * 2;
#X obj 1750 470 r \$0-pi;
#X obj 1730 550 /;
#X obj 1730 580 * 360;
#X text 1840 410 this takes into account inversion to correct yaw \,
resulting in heading if normalised to magnetic north - only required
if not available as precomputed data point, f 25;
#X text 1730 130 calculate heading from yaw, f 27;
#X text 1180 220 yaw is offset by 180 degrees orientation is inverted
;
#X obj 660 200 expr asin( 2 * ($f1 * $f3 - $f4 * $f2) );
#X obj 140 200 expr atan2( 2 * ($f1 * $f2 + $f3 * $f4) \, 1- 2 * ($f2
* $f2 + $f3 * $f3)), f 73;
#X obj 1730 150 r \$0-yaw-raw;
#X obj 1080 220 s \$0-yaw-raw;
#X obj 230 340 s inv;
#X obj 260 230 r \$0-pi;
#X text 1080 250 Φ = atan2(2(q0q1+q2q3) \, 1-2(q12+q22)) \; θ
= asin(2(q0q2-q3q1)) \; ψ = atan2(2(q0q3+q1q2)
\, 1-2(q22+q32)) \; , f 79;
#X text 140 110 quaternion to euler conversion;
#X obj 680 260 / 2;
#X obj 680 230 r \$0-pi;
#X obj 660 290 +;
#X obj 660 350 /;
#X obj 680 320 r \$0-pi;
#X obj 150 230 r \$0-pi;
#X obj 140 260 +;
#X obj 170 260 r \$0-pi;
#X obj 140 330 /;
#X obj 170 290 * 2;
#X obj 140 360 * 360;
#X obj 390 80 inlet;
#X obj 140 390 outlet;
#X obj 660 450 outlet;
#X obj 1730 605 outlet;
#X obj 660 390 * 180;
#X obj 660 420 - 90;
#X connect 0 0 26 0;
#X connect 1 0 2 0;
#X connect 2 0 27 0;
#X connect 3 0 2 1;
#X connect 4 0 5 1;
#X connect 5 0 8 0;
#X connect 6 0 5 0;
#X connect 7 0 8 1;
#X connect 8 0 18 0;
#X connect 9 0 4 0;
#X connect 11 0 10 0;
#X connect 12 0 11 0;
#X connect 13 0 12 0;
#X connect 14 0 4 1;
#X connect 15 0 7 0;
#X connect 16 0 18 1;
#X connect 17 0 16 0;
#X connect 18 0 19 0;
#X connect 19 0 45 0;
#X connect 23 0 33 0;
#X connect 24 0 1 0;
#X connect 24 0 39 0;
#X connect 25 0 6 0;
#X connect 28 0 3 0;
#X connect 31 0 33 1;
#X connect 32 0 31 0;
#X connect 33 0 34 0;
#X connect 34 0 46 0;
#X connect 35 0 34 1;
#X connect 36 0 37 1;
#X connect 37 0 39 0;
#X connect 38 0 40 0;
#X connect 39 0 41 0;
#X connect 40 0 39 1;
#X connect 41 0 43 0;
#X connect 42 0 24 0;
#X connect 42 0 23 0;
#X connect 42 0 0 0;
#X connect 46 0 47 0;
#X connect 47 0 44 0;
#X restore 758 402 pd quat2euler-gyrosc;
#X obj 310 270 s \$0-telem-raw;
#X obj 360 650 r \$0-telem-raw;
#X obj 600 340 r \$0-telem-raw;
#X obj 20 400 tgl 15 1 \$0-gyrosc empty empty 17 7 0 10 #fcfcfc #000000
#000000 1 1;
#X obj 760 370 gyrosc2elevon;
#X text 40 390 enable gyrOSC (port 9999), f 13;
#X obj 300 160 gate;
#X obj 760 340 r \$0-gyrosc;
#X obj 300 20 r \$0-gyrosc;
#X obj 300 110 -;
#X obj 300 70 t 1 f;
#X text 810 820 0 is level \; -90 is roll left \; 90 is roll right
\; returns to 0 when inverted;
#X text 630 790 GYROSC;
#X text 630 820 0 is level \; 90 is up \; 180/-180 is inverted
level \; -90 is down \;  \; 90 to 180 \, and -180 to -90 is
inverted, f 26;
#X text 630 690 0 is level \; -90 is roll left \; 90 is roll right
\; returns to 0 when inverted;
#X text 800 690 0 is level \; 90 is up \; 180/-180 is inverted
level \; -90 is down \;  \; 90 to 180 \, and -180 to -90 is
inverted, f 26;
#X text 630 660 TELEMOSC;
#X connect 7 0 8 0;
#X connect 8 0 6 0;
#X connect 8 1 6 1;
#X connect 15 0 76 1;
#X connect 16 0 15 0;
#X connect 17 0 19 0;
#X connect 18 0 28 0;
#X connect 18 0 70 0;
#X connect 19 0 18 0;
#X connect 20 0 16 0;
#X connect 21 0 25 0;
#X connect 22 0 23 0;
#X connect 22 1 25 1;
#X connect 23 0 27 0;
#X connect 24 0 50 0;
#X connect 25 0 26 0;
#X connect 26 0 7 0;
#X connect 27 0 21 0;
#X connect 27 1 21 1;
#X connect 28 0 22 0;
#X connect 30 0 33 0;
#X connect 31 0 49 0;
#X connect 33 0 31 0;
#X connect 33 1 34 0;
#X connect 34 0 32 1;
#X connect 49 0 32 0;
#X connect 50 0 21 0;
#X connect 55 0 65 0;
#X connect 56 0 60 0;
#X connect 60 0 61 1;
#X connect 60 0 61 0;
#X connect 60 1 62 1;
#X connect 60 1 62 0;
#X connect 61 0 63 0;
#X connect 62 0 63 1;
#X connect 63 0 64 0;
#X connect 64 0 58 0;
#X connect 65 0 66 0;
#X connect 65 1 67 0;
#X connect 65 2 68 0;
#X connect 69 0 66 0;
#X connect 69 1 67 0;
#X connect 69 2 68 0;
#X connect 71 0 56 0;
#X connect 72 0 55 0;
#X connect 74 0 69 0;
#X connect 76 0 17 0;
#X connect 77 0 74 0;
#X connect 78 0 80 0;
#X connect 79 0 76 0;
#X connect 80 0 79 0;
#X connect 80 1 79 1;
#X coords 0 -1 1 1 120 410 2 10 10;
